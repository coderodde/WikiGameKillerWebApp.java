<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <style>
            body {
                font-weight: bold;
                font-size: 12px;
                font-family: monospace;
            }
            
            .paramInput {
                width: 300px;
                padding: 10px 10px;
                margin: 8px 0;
                box-sizing: border-box;
                border: 3px solid #ccc;
                -webkit-transition: 0.8s;
                transition: 0.8s;
                outline: none;
                font-family: monospace;
                font-size: 13px;
                font-weight: bold;
            }
            
            .paramInput:focus {
                border: 3px solid #555;
                font-family: monospace;
                font-size: 13px;
                font-weight: bold;
            }
            
            .paramInput::placeholder {
                font-family: monospace;
                font-size: 13px;
                font-weight: bold;
            }
            
            .paramInput:error {
                border: 3px solid #555;
                font-family: monospace;
                font-size: 13px;
                font-weight: bold;
                border-color: #C01B00;
            }
            
        </style>
        
        <script>
            function constructWebSocket() {
                const host = document.location.host;
                const path = document.location.pathname;
                const webSocketUrl = `ws://${host}${path}search`;
                
                console.log(`Host: ${host}`);
                console.log(`Path: ${path}`);
                console.log(`WebSocket URL: ${webSocketUrl}`);
                
                const socket = new WebSocket(webSocketUrl);
                
                socket.onopen = (event) => {
                    console.log("onopen. Event: ", event);
                };
                
                socket.onmessage = (event) => {
                    const text = event.data;
                    console.log(`Received text: ${text}.`);
                };
                
                socket.onclose = (event) => {
                    console.log("onclose. Event: ", event);
                };
                
                socket.onerror = (event) => {
                    console.log("onerror. Event: ", event);
                };
                
                return socket;
            };
            
            function resetParametersToDefaults() {
                document.getElementById("threadsInput")          .value = "256";
                document.getElementById("expansionDurationInput").value = "4000";
                document.getElementById("waitTimeoutInput")      .value = "2";
                document.getElementById("trialsInput")           .value = "200";
                document.getElementById("masterSleepInput")      .value = "15";
                document.getElementById("slaveSleepInput")       .value = "1";
            }
            
            function spawnSearch() {
                const searchObject = {
                    "sourceUrl":           document.getElementById("sourceUrlInput")        .value,
                    "targetUrl":           document.getElementById("targetUrlInput")        .value,
                    "numberOfThreads":     document.getElementById("threadsInput")          .value,
                    "expansionDuration":   document.getElementById("expansionDurationInput").value,
                    "waitTimeout":         document.getElementById("waitTimeoutInput")      .value,
                    "masterTrials":        document.getElementById("trialsInput")           .value,
                    "masterSleepDuration": document.getElementById("masterSleepInput")      .value,
                    "slaveSleepDuration":  document.getElementById("slaveSleepInput")       .value
                };
                
                const json = JSON.stringify(searchObject);
                console.log("json: ", json);
                
                let webSocket = constructWebSocket();
                
                function sendData() {
                    if (webSocket.readyState) {    
                        webSocket.send(json);
                    } else {
                        setTimeout(sendData, 100);
                    }
                }
                
                sendData(json);
            }
            
            function wikipediaUrlIsValid(url) {
                return /^(http(s)?:\/\/)?..\.wikipedia\.org\/wiki\/.+$/.test(url);
            }
            
            function isPositiveInteger(str) {
                if (/^\d+$/.test(str)) {
                    return parseInt(str) > 0;
                }
                
                return false;
            }
            
            function colorInputBorder(elem) {
                document.getElementById("sourceUrlInput").style.borderColor = "red";
            }
            
            function onChangeThreads() {
                const input = document.getElementById("threadsInput");
                const currentValue = input.value;
                
                if (isPositiveInteger(currentValue)) {
                    input.value = currentValue;
                } else {
                    alert("shit");
                }
            }
        </script>
    </head>
    <body>
        <h1>WikiGameKiller 1.0.0</h1>
        
        <div id="input-form-div">
            <form action="/search" method="GET">
                <table>
                    <tr>
                        <td><label for="sourceUrlInput">Source URL:</label></td>
                        <td><input type="text"
                                   id="sourceUrlInput"
                                   class="paramInput"
                                   onchange="colorInputBorder(null);"
                                   placeholder="Source article URL"/> </td>
                    </tr>
                    
                    <tr>
                        <td><label for="targetUrlInput">Target URL:</label></td>
                        <td><input type="text"
                                   id="targetUrlInput"
                                   class="paramInput"
                                   placeholder="Target article URL"/> </td>
                    </tr>

                    <tr>
                        <td><label for="threadsInput">Number of threads</label></td>
                        <td><input type="number"
                                   id="threadsInput" 
                                   class="paramInput" 
                                   value="256" 
                                   onchange="onChangeThreads();" /> </td>
                    </tr>

                    <tr>
                        <td><label for="expansionDurationInput">Maximum expansion duration</label></td>
                        <td><input type="number" 
                                   id="expansionDurationInput" 
                                   class="paramInput"
                                   value="4000"
                                   placeholder="Milliseconds"/> </td>
                    </tr>
                    
                    <tr>
                        <td><label for="waitTimeoutInput">Maximum mutex timeout</label></td>
                        <td><input type="number"
                                   id="waitTimeoutInput"
                                   class="paramInput"
                                   value="2"
                                   placeholder="Milliseconds"/> </td>
                    </tr>

                    <tr>
                        <td><label for="trialsInput">Number of master trials</label></td>
                        <td><input type="number"
                                   id="trialsInput"
                                   class="paramInput"
                                   value="200" /> </td>
                    </tr>
                    
                    <tr>
                        <td><label for="masterSleepInput">Master sleep duration:</label></td>
                        <td><input type="number"
                                   id="masterSleepInput"
                                   class="paramInput"
                                   value="15"
                                   placeholder="Milliseconds"/> </td>
                    </tr>

                    <tr>
                        <td><label for="slaveSleepInput">Slave sleep duration:</label></td>
                        <td><input type="number"
                                   id="slaveSleepInput" 
                                   class="paramInput"
                                   value="1"
                                   placeholder="Milliseconds"/> </td>
                    </tr>
                </table>
                
            </form>
            <button id="doSearch" onclick="spawnSearch();">Search</button> 
            <button id="setDefaultsButton" onclick="resetParametersToDefaults();">Set default parameters</button>
            <button id="haltButton" disabled>Halt</button>
        </div>
        
        <div id="result-div">
            
        </div>
        <footer>By Rodion "coderodde" Efremov. Copyleft 2024</footer>
    </body>
</html>
